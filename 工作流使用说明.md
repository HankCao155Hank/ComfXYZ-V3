# ComfXYZ-V3 新增工作流使用说明

## 概述

已成功在 ComfXYZ-V3 项目中创建了三个新的可运行工作流，支持不同的图像生成 API 提供商。

## 新增工作流

### 1. 豆包 Seedream 图像生成

**工作流名称**: 豆包 Seedream 图像生成  
**描述**: 使用豆包 Seedream 模型生成高质量图像，支持多种尺寸比例  
**API 提供商**: doubao_seedream  

**默认参数**:
- 提示词: "一只可爱的小猫在花园里玩耍"
- 负向提示词: "模糊, 低质量, 变形"
- 图像尺寸: "1024x1024"
- 随机种子: 12345

**支持的尺寸**:
- 1024×1024 (1:1)
- 1024×1792 (9:16)
- 1792×1024 (16:9)
- 1664×2496 (2:3)

### 2. 通义千问图像生成

**工作流名称**: 通义千问图像生成  
**描述**: 使用阿里云通义千问图像生成模型，支持多种尺寸比例  
**API 提供商**: qwen_image  

**默认参数**:
- 提示词: "一只聪明的小狗在公园里奔跑"
- 负向提示词: "模糊, 低质量, 变形"
- 图像尺寸: "1328*1328"
- 随机种子: 54321

**支持的尺寸**:
- 1328×1328 (1:1)
- 1664×928 (16:9)
- 1472×1140 (4:3)
- 1140×1472 (3:4)
- 928×1664 (9:16)

### 3. 美图 AI 图像编辑

**工作流名称**: 美图 AI 图像编辑  
**描述**: 使用美图 AI 开放平台进行图像修复和编辑  
**API 提供商**: meitu  

**默认参数**:
- 提示词: "将背景替换为海滩场景"
- 图片 URL: "https://example.com/image.jpg"
- 蒙版 URL: "https://example.com/mask.jpg"

## 使用方法

### 1. 通过前端界面使用

1. 访问 `http://localhost:3000/dashboard`
2. 在"工作流管理"标签页中找到新创建的工作流
3. 点击工作流卡片上的"生成"按钮
4. 在参数设置表单中：
   - 选择对应的 API 提供商
   - 修改提示词和其他参数
   - 点击"开始生成"

### 2. 通过 API 直接调用

```javascript
// 豆包 Seedream 工作流
const response = await fetch('/api/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    workflowId: 'cmfqja8in00007586f4v19vu2', // 豆包工作流ID
    customParams: {
      prompt: '一只可爱的小猫在花园里玩耍',
      negative_prompt: '模糊, 低质量, 变形',
      size: '1024x1024',
      seed: 12345
    }
  })
});

// 通义千问工作流
const response = await fetch('/api/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    workflowId: 'cmfqja96q000175860mysvk4q', // 通义千问工作流ID
    customParams: {
      prompt: '一只聪明的小狗在公园里奔跑',
      negative_prompt: '模糊, 低质量, 变形',
      size: '1328*1328',
      seed: 54321
    }
  })
});

// 美图 AI 工作流
const response = await fetch('/api/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    workflowId: 'cmfqja9gd00027586xqiqa30f', // 美图AI工作流ID
    customParams: {
      prompt: '将背景替换为海滩场景',
      image_url: 'https://example.com/image.jpg',
      mask_url: 'https://example.com/mask.jpg'
    }
  })
});
```

## 环境变量配置

要使用这些工作流，需要在 `.env` 文件中配置相应的 API 密钥：

```env
# 通义千问图像生成 API 密钥
DASHSCOPE_API_KEY=your_dashscope_api_key_here

# 豆包 Seedream 图像生成 API 密钥
SEED_EDIT_KEY=your_seed_edit_key_here

# 美图 AI 开放平台 API 密钥
MEITU_API_KEY=your_meitu_api_key_here
```

## 技术实现

### 工作流路由逻辑

系统会自动根据工作流数据中的 `provider` 字段路由到相应的 API：

1. **自动检测**: 从工作流的 `nodeData` 中提取 `provider` 信息
2. **智能路由**: 根据 `provider` 值调用相应的 API 函数
3. **统一返回**: 所有 API 都返回统一的格式

### 支持的 API 提供商

- `doubao_seedream` → 豆包 Seedream API
- `qwen_image` → 通义千问图像生成 API
- `meitu` → 美图 AI 开放平台 API
- `wuwen` → 无问芯穹 (ComfyUI) API

## 测试状态

### ✅ 已完成
- 工作流创建成功
- API 路由逻辑正确
- 前端界面正常显示
- 参数传递正确

### ⚠️ 需要配置
- API 密钥配置（需要真实的密钥才能完成图像生成）
- 美图 AI 需要有效的图片 URL 和蒙版 URL

## 故障排除

### 常见问题

1. **API 密钥错误**
   - 确保在 `.env` 文件中配置了正确的 API 密钥
   - 检查密钥格式是否正确

2. **工作流不存在**
   - 确保工作流 ID 正确
   - 检查数据库中是否存在对应的工作流

3. **参数错误**
   - 检查提示词长度（通义千问和豆包限制800字符）
   - 确保图像尺寸格式正确
   - 美图 AI 需要有效的图片 URL

### 调试方法

1. 查看服务器日志获取详细错误信息
2. 使用浏览器开发者工具检查网络请求
3. 验证 API 密钥是否有效

## 扩展功能

### 添加新工作流

要添加新的工作流，可以：

1. 使用 `scripts/create-workflows.js` 脚本
2. 通过前端界面创建工作流
3. 直接调用 `/api/workflows` API

### 自定义参数

每个工作流都支持自定义参数：

- **提示词**: 描述想要生成的图像
- **负向提示词**: 描述不想要的元素
- **图像尺寸**: 根据 API 提供商选择支持的尺寸
- **随机种子**: 控制生成结果的随机性

现在您可以在 ComfXYZ-V3 项目中使用这些新的工作流进行图像生成了！
